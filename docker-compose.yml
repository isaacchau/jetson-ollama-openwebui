version: '3'

services:

  ollama:
    # Need to execute "autotag ollama" to get the correct image version on your device
    image: dustynv/ollama:r35.4.1
    runtime: nvidia
    command: /usr/bin/ollama serve
    network_mode: host
    volumes:
      - /tmp/argus_socket:/tmp/argus_socket
      - /etc/enctune.conf:/etc/enctune.conf
      - /etc/nv_tegra_release:/etc/nv_tegra_release
      - /tmp/nv_jetson_model:/tmp/nv_jetson_model
      - /var/run/dbus:/var/run/dbus
      - /var/run/avahi-daemon/socket:/var/run/avahi-daemon/socket
      - /var/run/docker.sock:/var/run/docker.sock
      # Mount the following directory to share the model with jetson-containers
      - /home/ubuntu/jetson-containers/data:/data
    restart: unless-stopped

  open-webui:
    image: ghcr.io/open-webui/open-webui:main
    network_mode: host
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ./data:/app/backend/data
    restart: unless-stopped
    depends_on:
      - ollama
    environment:
      - ENABLE_RAG_WEB_SEARCH=true
      - RAG_WEB_SEARCH_ENGINE=duckduckgo

